<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Kakao 지도</title>
    <style>
        .cafe-marker-label {
            padding: 3px 5px;
            background: white;
            border: 1px solid black;
            border-radius: 3px;
            text-align: center;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 10px;
            white-space: nowrap;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .cafe-marker-label.co-work {
            background: #ffe9bc;
            color: rgb(0, 0, 0);
        }
    </style>
</head>
<body>
    <div id="map" style="width:100%;height:100vh;"></div>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0263a29ce4d7869fc8090d309d2bc371"></script>
    <script>
        var map;
        var markers = [];

        function initMap() {
            var container = document.getElementById('map');
            var options = {
                center: new kakao.maps.LatLng(37.58823, 126.9936),
                level: 3
            };
            map = new kakao.maps.Map(container, options);
        }

        function addMarker(cafe) {
            var content = document.createElement('div');
            content.className = 'cafe-marker-label';
            if (cafe['Co-work'] === 1 || cafe['Co-work'] === '1') {
                content.classList.add('co-work');
            }
            content.innerHTML = cafe.Name + '<br>' + getHoursDisplay(cafe.Hours_weekday);

            var customOverlay = new kakao.maps.CustomOverlay({
                map: map,
                position: new kakao.maps.LatLng(cafe['Position (Latitude)'], cafe['Position (Longitude)']),
                content: content,
                yAnchor: 1.1
            });

            markers.push(customOverlay);

            kakao.maps.event.addListener(customOverlay, 'click', function() {
                CafeChannel.postMessage(JSON.stringify(cafe));
            });
        }

        function getHoursDisplay(hours) {
            if (hours === -1) return '무제한';
            if (hours === 0) return '권장X';
            return hours + '시간';
        }

        function addCafes(cafeData) {
            var cafes = JSON.parse(cafeData);
            cafes.forEach(addMarker);
        }

        function moveToLocation(lat, lng) {
            map.setCenter(new kakao.maps.LatLng(lat, lng));
        }

        window.onload = initMap;
    </script>
</body>
</html>